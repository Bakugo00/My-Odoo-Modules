<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <data noupdate="0">

        <record id="group_mark_as_done" model="res.groups">
            <field name="name">Marquer comme Fait les activités</field>
        </record>

        <record id="group_update_customer" model="res.groups">
            <field name="name">Modifier les infos du client dans le devis</field>
        </record>

        <!-- Shared Sales Order and Shared Sales Order Line Assignation rules -->

        <record id="sale_order_shared_personal_rule" model="ir.rule">
            <field name="name">Visibilité des devis pour les participants</field>
            <field ref="model_sale_order" name="model_id"/>
            <field name="domain_force">[('attendees_ids.user_id','=',user.id)]</field>
            <field name="groups" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
            <field name="perm_unlink" eval="False"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="True"/>
        </record>

        <record id="sale_order_line_shared_personal_rule" model="ir.rule">
            <field name="name">Visibilité des lignes de devis pour les participants</field>
            <field ref="model_sale_order_line" name="model_id"/>
            <field name="domain_force">[('order_id.attendees_ids.user_id','=',user.id)]</field>
            <field name="groups" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
            <field name="perm_unlink" eval="False"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="True"/>
        </record>

        <record id="sale_attendees_amount_rule" model="ir.rule">
            <field name="name">Visibilité du montant du participation pour les participants</field>
            <field ref="model_sale_attendees_amount" name="model_id"/>
            <!--            <field name="domain_force">['|',('user_id','=',user.id),('user_id','=',False) ]</field>-->
            <field name="domain_force">[('user_id','=',user.id)]</field>
            <!--            <field name="groups" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>-->
            <field name="groups"
                   eval="[(6,0, [ref('sales_team.group_sale_salesman'), ref('sales_team.group_sale_manager') , ref('sales_team.group_sale_salesman_all_leads')])]"/>
            <field name="perm_unlink" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="True"/>
        </record>

        <record id="group_doc_quotation_customer" model="res.groups">
            <field name="name">Document BC client</field>
            <field name="category_id" ref="base.module_category_hidden"/>
        </record>

        
<!-- Groups Sale order -->
<!--Manager N+1 group-->
        <record id="group_sale_order_n" model="res.groups">
            <field name="name">Manager N+1</field>
            <field name="category_id" ref="base.module_category_sales_sales"/>
            <field name="implied_ids" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
        </record>
<!--Manager RH group-->
        <record id="group_sale_order_manager_rh" model="res.groups">
            <field name="name">Manager RH</field>
            <field name="category_id" ref="base.module_category_sales_sales"/>
            <field name="implied_ids" eval="[(4, ref('group_sale_order_n'))]"/>
        </record>


<!--Rules-->
<!--Only department access to sale order-->
        <record id="sale_order_rule_manager_n" model="ir.rule">
            <field name="name">sale.order.rule.manager.n</field>
            <field name="model_id" ref="model_sale_order"/>
            <field name="domain_force">['|',('partner_id.portfolio_ids.owner_id.employee_ids.parent_id','child_of',user.employee_ids.ids),('partner_id.portfolio_ids.user_ids.employee_ids.parent_id','child_of',user.employee_ids.ids)]</field>
            <field name="groups" eval="[(4, ref('group_sale_order_manager_rh')),(4,ref('group_sale_order_n'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>
<!--Collaborateur rule for sale order-->
        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value eval="[('module', 'in', ['sale']), ('name', 'in', ['sale_order_personal_rule'])]"/>
            </function>
            <value eval="{'noupdate': False}"/>
        </function>
        <record id="sale.sale_order_personal_rule" model="ir.rule">
            <field name="domain_force">['|',('partner_id.portfolio_ids.owner_id.id','in',[user.id]),('partner_id.portfolio_ids.user_ids.id','in',[user.id])]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        <data noupdate="0">
            <record model="res.groups" id="sales_team.group_sale_salesman_all_leads" >
                <field name="name">Manager IT/Direction</field>
                <field name="implied_ids" eval="[(6,0, [ref('group_sale_order_manager_rh')])]"/>
            </record>
        </data>
    </data>
</odoo>