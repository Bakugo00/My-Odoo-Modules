<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <data>

        <record id="mail_activity_form_popup_inherit" model="ir.ui.view">
            <field name="name">mail.activity.form.inherit</field>
            <field name="model">mail.activity</field>
            <field name="inherit_id" ref="mail.mail_activity_view_form_popup" />
            <field name="arch" type="xml">
                <xpath expr="//form" position="replace">
                    <form string="Activity Form">
                        <sheet string="Activity">
                            <div class="oe_button_box" name="button_box" invisible="1">
                                <button name="action_open_document" string="Open Document"
                                    type="object" class="oe_link" icon="fa-file-text-o"
                                    attrs="{'invisible': ['|', ('res_model', '=', False), ('res_id', '=', 0)]}" />
                            </div>
                            <group invisible="1">
                                <field name="activity_category" invisible="1" />
                                <field name="res_model" invisible="1" />
                                <field name="res_model_id" invisible="1" />
                                <field name="res_id" invisible="1" />
                                <field name="chaining_type" invisible="1" />
                                <field name="previous_activity_type_id" />
                                <field name="has_recommended_activities" />
                            </group>
                            <group attrs="{'invisible': [('has_recommended_activities','=',False)]}">
                                <field name="recommended_activity_type_id" widget="selection_badge"
                                    domain="[('previous_type_ids', '=', previous_activity_type_id)]"
                                    string="Recommended Activities" />
                            </group>
                            <group>
                                <group>
                                    <div class="column-group">
                                        <div class="o_row">
                                            <label for="contact_id" string="Contact" class="o_label" />
                                            <span class="fa fa-user mr-2" />
                                            <field name="contact_id" class="o_field" required="1"
                                                context="{'activity_partner_id': res_id,'activity_model': res_model}"
                                                options="{'no_open': True,'no_quick_create':True,'no_create_edit': True,'no_create': True}" />
                                        </div>
                                        <div class="o_row">
                                            <label for="activity_type_id" class="o_label" />
                                            <span class="fa fa-tasks mr-2" />
                                            <field name="activity_type_id" class="o_field"
                                                required="1"
                                                options="{'no_create': True, 'no_open': True}" />
                                        </div>
                                        <div class="o_row">
                                            <label for="summary" class="o_label" />
                                            <field name="summary"
                                                placeholder="e.g. Discuss proposal" class="o_field" />
                                        </div>
                                        <div class="o_row">
                                            <label for="sources" class="o_label" />
                                            <field name="sources" class="o_field" />
                                        </div>
                                        <field name="has_activity" invisible="1" />
                                        <field name="company_id" invisible="1" />
                                        <div class="o_row">
                                            <label for="result_categ_id" class="o_label"
                                                style="width: auto; white-space: nowrap;" />
                                            <field name="result_categ_id" class="o_field"
                                                domain="[('type_ids','=',activity_type_id)]"
                                                attrs="{'required': [ ('state', 'not in', ('planned', 'today')) ]}"
                                                options="{'no_open': True,'no_quick_create':True,'no_create_edit': True,'no_create': True}" />
                                        </div>
                                        <div class="o_row">
                                            <label for="result_id" class="o_label" />
                                            <field name="result_id" class="o_field"
                                                domain="[('categ_id','=',result_categ_id)]"
                                                attrs="{'required': [ ('state', 'not in', ('planned', 'today')) ] }"
                                                options="{'no_open': True,'no_quick_create':True,'no_create_edit': True,'no_create': True}" />
                                        </div>
                                    </div>
                                </group>


                                <group>
                                    <div class="column-group">
                                        <div class="o_row">
                                            <label for="state" class="o_label" />
                                            <field name="state" class="o_field" />
                                        </div>
                                        <div class="o_row">
                                            <label for="date_deadline" class="o_label" />
                                            <span class="fa fa-calendar mr-2" />
                                            <field name="date_deadline" class="o_field" />
                                        </div>
                                        <div class="o_row">
                                            <label for="time_deadline" class="o_label" />
                                            <span class="fa fa-clock-o" />
                                            <field name="time_deadline" class="o_field"
                                                widget="float_time" />
                                        </div>
                                        <div class="o_row">
                                            <label for="user_id" class="o_label" />
                                            <field name="user_id" class="o_field" readonly="1" />
                                        </div>
                                        <div class="o_row">
                                            <label for="participants" class="o_label"
                                                attrs="{'invisible': [('activity_category', '!=', 'meeting')]}" />
                                            <field name="participants" string="Participants"
                                                widget='many2many_tags'
                                                attrs="{'invisible': [('activity_category', '!=', 'meeting')]}"
                                                class="o_field" />
                                        </div>
                                    </div>
                                </group>
                            </group>
                            <field name="note" class="oe-bordered-editor"
                                placeholder="Log a note..." />
                            <separator string="Planifier un rappel" />
                            <group>
                                <group>
                                    <div class="column-group">
                                        <div class="o_row">
                                            <label for="reminder_type_id" class="o_label" />
                                            <span class="fa fa-tasks mr-2" />
                                            <field name="reminder_type_id" class="o_field"
                                                required="1"
                                                options="{'no_create': True, 'no_open': True}" />
                                        </div>
                                        <div class="o_row">
                                            <label for="reminder_summary" class="o_label" />
                                            <field name="reminder_summary" class="o_field" />
                                        </div>
                                    </div>

                                </group>
                                <group>
                                    <div class="column-group">
                                        <div class="o_row">
                                            <label for="reminder_date" class="o_label" />
                                            <span class="fa fa-calendar mr-2" />
                                            <field name="reminder_date" class="o_field" />
                                        </div>
                                        <div class="o_row">
                                            <label for="reminder_time" class="o_label" />
                                            <span class="fa fa-clock-o" />
                                            <field name="reminder_time" class="o_field"
                                                widget="float_time" />
                                        </div>
                                        <field name="is_reminder" invisible="1" />
                                    </div>
                                </group>
                            </group>
                            <field name="reminder_note" class="oe-bordered-editor"
                                placeholder="Log a note..." />
                            <footer>
                                <field name="id" invisible="1" />
                                <button id="mail_activity_schedule" string="Mark as done"
                                    name="action_close_dialog" type="object" class="btn-primary"
                                    attrs="{'invisible': ['|',('id', '!=', False),('has_activity', '=', True)]}"
                                    data-hotkey="q" /> 
                                <button id="mail_activity_save" string="Save"
                                    name="action_close_dialog" type="object" class="btn-primary"
                                    attrs="{'invisible': [('id', '=', False)]}" data-hotkey="q" />
                                <div class="o_button" groups="contacts.group_contacts_manager_n">
                                    <label string="Clôturer cet évènement" for="is_event_closed"/>
                                    <field name="is_event_closed" widget="boolean_toggle"
                                        attrs="{'invisible': [('chaining_type', '=', 'trigger')]}"
                                        string="Clôturer cet évènement" />
                                </div>

                                <button attrs="{'invisible': [('chaining_type', '=', 'trigger')]}"
                                    string="Clôturer cet évènement" name="action_done" type="object"
                                    class="btn-secondary" data-hotkey="w"
                                    context="{'mail_activity_quick_update': True}" invisible="1" />
                                <button
                                    attrs="{'invisible': ['|',('chaining_type', '=', 'trigger'),('id', '=', False)]}"
                                    string="Done &amp; Schedule Next"
                                    name="action_done_schedule_next" type="object"
                                    class="btn-secondary" data-hotkey="x"
                                    context="{'mail_activity_quick_update': True}" />
                                <button
                                    attrs="{'invisible': ['|',('chaining_type', '=', 'suggest'),('id', '=', False)]}"
                                    string="Done &amp; Launch Next" name="action_done_schedule_next"
                                    type="object" class="btn-secondary" data-hotkey="x"
                                    context="{'mail_activity_quick_update': True}" />
                                <button string="Discard" class="btn-secondary" special="cancel"
                                    invisible="1"
                                    data-hotkey="z" />
                            </footer>
                        </sheet>


                    </form>
                </xpath>

            </field>
        </record>

        <record id="mail_activity_form_inherit" model="ir.ui.view">
            <field name="name">mail.activity.form.inherit</field>
            <field name="model">mail.activity</field>
            <field name="inherit_id" ref="mail.mail_activity_view_form" />
            <field name="arch" type="xml">


                <xpath expr="//form/sheet" position="before">
                    <header>
                        <button id="mail_activity_schedule" string="Planifier"
                            name="action_close_dialog" type="object" class="btn-primary"
                            attrs="{'invisible': ['|',('id', '!=', False),('has_activity', '=', True)]}"
                            data-hotkey="q" />
                        <button attrs="{'invisible': [('chaining_type', '=', 'trigger')]}"
                            string="MARQUÉ COMME FAIT" name="action_done" type="object"
                            class="btn-primary" data-hotkey="w"
                            context="{'mail_activity_quick_update': True,'target_current': True}" />
                        <button
                            attrs="{'invisible': ['|',('chaining_type', '=', 'trigger'),('id', '=', False)]}"
                            string="TERMINÉ &amp; PROGRAMMER SUIVANT"
                            name="action_done_schedule_next" type="object" class="btn-primary"
                            data-hotkey="x"
                            context="{'mail_activity_quick_update': True,'target_current': True}" />
                        <button
                            attrs="{'invisible': ['|',('chaining_type', '=', 'suggest'),('id', '=', False)]}"
                            string="TERMINÉ &amp; LANCER LA SUITE" name="action_done_schedule_next"
                            type="object" class="btn-primary" data-hotkey="x"
                            context="{'mail_activity_quick_update': True,'target_current': True}" />
                    </header>

                </xpath>

                <xpath expr="//form/sheet" position="after">
                    <div class="oe_chatter">
                        <field name="message_ids" />
                    </div>

                </xpath>


            </field>
        </record>

        <record id="mail_activity_graph" model="ir.ui.view">
            <field name="name">mail.activity.report_graph</field>
            <field name="model">mail.activity</field>
            <field name="arch" type="xml">
                <graph string="Graphe des Activités" sample="1">
                    <field name="activity_type_id" />
                    <field name="user_id" string="Utilisateur" />
                    <field name="result_categ_id" type="measure" />
                    <field name="result_id" type="measure" />
                </graph>
            </field>
        </record>

        <record id="mail.mail_activity_action" model="ir.actions.act_window">
            <field name="name">Activities</field>
            <field name="res_model">mail.activity</field>
            <field name="view_mode">tree,form,graph</field>
        </record>

        <record id="mail_activity_view_tree_inherit" model="ir.ui.view">
            <field name="name">mail.activity.view.tree.inherit</field>
            <field name="model">mail.activity</field>
            <field name="inherit_id" ref="mail.mail_activity_view_tree" />
            <field name="arch" type="xml">
                <xpath expr="//tree" position="attributes">
                    <attribute name="default_order">date_deadline desc</attribute>
                </xpath>
                <xpath expr="//tree/field[@name='res_name']" position="after">
                    <field name="contact_id" />
                </xpath>
            </field>
        </record>

        <record id="mail_activity_view_search_inherit" model="ir.ui.view">
            <field name="name">mail.activity.view.search.inherit</field>
            <field name="model">mail.activity</field>
            <field name="inherit_id" ref="mail.mail_activity_view_search" />
            <field name="arch" type="xml">
                <xpath expr="//search/field[@name='summary']" position="after">
                    <field name="contact_id" />
                </xpath>
            </field>
        </record>

        <record id="ir_cron_reminder_check" model="ir.cron">
            <field name="name">Check Activity Reminders</field>
            <field name="model_id" ref="model_mail_activity" />
            <field name="state">code</field>
            <field name="code">model._check_reminders()</field>
            <field name="interval_number">1</field>
            <field name="interval_type">days</field>
            <field name="numbercall">-1</field>
            <field name="doall" eval="False" />
            <field name="active" eval="True" />
        </record>

    </data>
</odoo>